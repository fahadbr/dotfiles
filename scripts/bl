#!/bin/sh
bl_dev=/sys/class/backlight/intel_backlight
if uname -a | grep Ubuntu >/dev/null; then
	step=500
else
	step=100
fi

cur_brightness=$(cat $bl_dev/brightness)

case $1 in
  -)
		target_brightness=$(($cur_brightness - $step))
		if [[ $target_brightness -lt 0 ]]; then
			echo 0 >$bl_dev/brightness
		else
			echo $target_brightness>$bl_dev/brightness
		fi
		;;
  +)
		target_brightness=$(($cur_brightness + $step))
		max_brightness=$(cat $bl_dev/max_brightness)
		if [[ $target_brightness -gt $max_brightness ]]; then
			echo $max_brightness>$bl_dev/brightness
		else
			echo $target_brightness>$bl_dev/brightness
		fi
		;;
esac

# update i3blocks
# pkill -RTMIN+2 i3blocks

# print brightness
# echo "$(cat $bl_dev/brightness)/$(cat $bl_dev/max_brightness)"

# notify brightness
bpct=$(echo "scale=2;$(cat /sys/class/backlight/intel_backlight/brightness)/$(cat /sys/class/backlight/intel_backlight/max_brightness)*100" | bc | sed -E -n 's/([0-9]+)\.?([0-9]*)/\1 %/p')
dunstify -a "ï†… Brightness" -t 2000 -r 2594 -u normal "$bpct"
